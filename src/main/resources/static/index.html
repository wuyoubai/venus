<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head >
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="css/index.css">
    <title>我是垃圾</title>
    <!-- import Vue before Element -->
    <script src="js/vue.js"></script>
    <!-- import JavaScript -->
    <script src="js/index.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <link  href="./lib/cropper/cropper.css" rel="stylesheet">
    <script src="./lib/cropper/cropper.js"></script>
    <script src="./js/common.js"></script>
    <style>
        .line{
            text-align: center;
        }
        .row-input input{
            height: 30px;
        }
        .el-radio__label{
            display: none;
        }
        .menu-item-height{
            height: 40px;
            line-height: 40px;
        }
    </style>
</head>
<body style="background-color: rgb(248, 248, 248);">
<div id="app">
    <el-container style="height: 850px; border: 1px solid #eee">
        <el-aside width="140px" style="background-color: #545c64">
            <div style="width: 100%; height: 50px; text-align: center;background-color: rgba(91, 191, 177, 1);">
                <span style="height: 50px;line-height: 50px;font-size: 22px;font-weight: 600;color: rgba(255, 255, 255, 1)">管理员后台</span>
            </div>
            <div style="width: 100%; height: 100px; display: flex;">
                <div style="background-color: rgba(153, 153, 153, 1); width: 40px;height: 40px;float: left;border-radius: 50%;margin:35px 20px 0 10px;"></div>
                <div style="color: #ffffff; line-height: 14px;font-size: 14px">
                    <p>{{loginUserName}}</p>
                    <p>
                        <span style="cursor: pointer" @click="passwordFormVisible = true">修改密码</span>
                    </p>
                    <p>
                        <span style="margin-left: 0;cursor: pointer" @click="logout">退出</span>
                    </p>
                </div>
            </div>
            <el-dialog title="修改密码" :visible.sync="passwordFormVisible" :width="passwordFormWidth">
                <el-form :model="passwordForm" ref="passwordForm">
                    <el-form-item :label-width="passwordFormLabelWidth" prop="oldPassword" label="旧密码" required :rules="[
                            {required: true, message: '请输入旧密码' },
                            {min: 6, max: 32, message: '长度在 6 到 32 个字符' },
                        ]">
                        <el-input type="password" v-model="passwordForm.oldPassword" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item :label-width="passwordFormLabelWidth" prop="newPassword" label="新密码" required :rules="[
                            {required: true, message: '请输入新密码' },
                            {min: 6, max: 32, message: '长度在 6 到 32 个字符' },
                        ]">
                        <el-input type="password" v-model="passwordForm.newPassword" autocomplete="off"></el-input>
                    </el-form-item>
                    <el-form-item :label-width="passwordFormLabelWidth" prop="rePassword" label="新密码确认" required :rules="[
                            {required: true, message: '请输入确认密码' },
                            {min: 6, max: 32, message: '长度在 6 到 32 个字符' },
                        ]">
                        <el-input type="password" v-model="passwordForm.rePassword" autocomplete="off"></el-input>
                    </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="passwordFormVisible = false">取 消</el-button>
                    <el-button type="primary" @click="handleUpdatePassword()">确 定</el-button>
                </div>
            </el-dialog>
            <el-menu default-active="1" class="el-menu-vertical-demo" background-color="#545c64"
                     text-color="#fff" active-text-color="#ffd04b">
                <el-menu-item index="1" @click="changeMenu(1)" class="menu-item-height">
                    <i class="el-icon-menu"></i>
                    <span slot="title">企业维护</span>
                </el-menu-item>
                <el-menu-item index="2" @click="changeMenu(2)" class="menu-item-height">
                    <i class="el-icon-document"></i>
                    <span slot="title">企业用户</span>
                </el-menu-item>
                <el-menu-item index="3" @click="changeMenu(3)" class="menu-item-height">
                    <i class="el-icon-setting"></i>
                    <span slot="title">后台账户</span>
                </el-menu-item>
            </el-menu>
        </el-aside>

        <el-container>
            <el-main>
                <group-table v-if="showAndHide.group_table" :menush="showAndHide"></group-table>
                <hr-table v-if="showAndHide.hr_table"></hr-table>
                <internalusers-table v-if="showAndHide.internalusers_table"></internalusers-table>
            </el-main>
        </el-container>

    </el-container>
</div>

<template id="group-table" >
    <div class="block">
        <div style="display: flex">
            <div style="width: 820px">
                <h1 style="color: rgba(91, 191, 177, 1);">企业维护</h1>

                <el-form class="demo-ruleForm" :inline="true">
                    <el-form-item label="" style="width: 150px">
                        <el-input type="text" size="mini" autocomplete="off" placeholder="企业名称" v-model="queryParam.groupname"></el-input>
                    </el-form-item>
                    <el-form-item label="" style="width: 80px">
                        <el-select size="mini" placeholder="状态" v-model="queryParam.status">
                            <el-option label="启用" value="0"></el-option>
                            <el-option label="禁用" value="1"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="" style="width: 80px">
                        <el-select size="mini" placeholder="认证" v-model="queryParam.legalize">
                            <el-option label="已认证" value="0"></el-option>
                            <el-option label="未认证" value="1"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item>
                        <el-button size="mini" type="primary" @click="handleQuery">搜索</el-button>
                        <el-button size="mini" @click="handleReset">重置</el-button>
                    </el-form-item>
                    <el-form-item style="margin-left: 90px">
                        <template slot-scope="scope">
                            <el-button size="mini" type="primary" @click="showAddForm('groupForm')">新增</el-button>
                            <el-button size="mini" type="primary" @click="showEditForm()">编辑</el-button>
                            <el-button size="mini" type="danger" @click="delGroup()">删除</el-button>
                        </template>
                    </el-form-item>
                </el-form>

                <el-table :data="td" @selection-change="handleSelectionChange">
                    <el-table-column type="selection" width="50">
                    </el-table-column>
                    <el-table-column label="序号" width="50" type="index" align="center">
                    </el-table-column>
                    <el-table-column prop="groupname" label="企业名称" width="150" align="center">
                    </el-table-column>
                    <el-table-column prop="groupuser" label="联系人" width="80" align="center">
                    </el-table-column>
                    <el-table-column prop="groupphone" label="联系方式" width="110" align="center">
                    </el-table-column>
                    <el-table-column label="认证情况" width="100" align="center">
                        <template slot-scope="scope">
                            <span v-if="scope.row.legalize===0" style="color:dodgerblue">{{ groupLegalizeText(scope.row.legalize) }}</span>
                            <span v-else style="color:orange">{{ groupLegalizeText(scope.row.legalize) }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column label="状态" width="70">
                        <template slot-scope="scope">
                            <span v-if="scope.row.status===0" style="color:green">{{ groupStatusText(scope.row.status) }}</span>
                            <span v-else style="color:red">{{ groupStatusText(scope.row.status) }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="contractEndTime" label="有效期" width="110" align="center">
                    </el-table-column>
                    <el-table-column label="备注" width="100" align="center">
                        <template slot-scope="scope">
                            <el-popover trigger="hover" placement="top" width="200">
                                <div word-break="break-all">{{ scope.row.remark }}</div>
                                <div slot="reference" class="name-wrapper">
                                    <el-tag size="medium">详情</el-tag>
                                </div>
                            </el-popover>
                        </template>
                    </el-table-column>
                </el-table>
                <el-pagination v-if="showPage" background layout="prev, pager, next"
                               :total="total" @current-change="handleCurrentChange">
                </el-pagination>
            </div>
            <div style="width: 400px; margin-left: 30px">
                <h1 style="color: red;">到期提醒</h1>
                <el-table :data="tdd">
                    <el-table-column prop="groupname" label="企业名称" width="100" align="center">
                    </el-table-column>
                    <el-table-column prop="groupphone" label="联系方式" width="120" align="center">
                    </el-table-column>
                    <el-table-column prop="contractEndTime" label="到期时间" width="110" align="center">
                    </el-table-column>
                </el-table>
                <el-pagination v-if="tdd_showPage" background layout="prev, pager, next"
                               :total="tdd_total" @current-change="handleTddCurrentChange">
                </el-pagination>
            </div>

            <el-dialog title="新增企业" :visible.sync="addFormVisible" :width="addFormWidth">
                <el-form :model="groupForm" ref="groupForm">
                    <el-form-item :label-width="formLabelWidth" prop="groupname" label="企业名" required :rules="[
                            {required: true, message: '请输入企业名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                        <el-input type="groupname" v-model="groupForm.groupname" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="groupuser" label="联系人" required :rules="[
                            {required: true, message: '请输入联系人' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                        <el-input type="groupuser" v-model="groupForm.groupuser" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="groupphone" label="联系方式" required :rules="[
                            {required: true, message: '请输入联系方式' }
                        ]">
                        <el-input type="contractEndTime" v-model="groupForm.groupphone" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="contractEndTime" label="到期时间">
                        <el-date-picker
                                v-model="groupForm.contractEndTime"
                                align="right"
                                type="date"
                                placeholder="选择日期"
                                :picker-options="pickerOptions"
                                format="yyyy 年 MM 月 dd 日"
                                value-format="yyyy-MM-dd">>
                        </el-date-picker>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="remark" label="备注" required :rules="[
                            {required: true, message: '请输入备注' }
                        ]">
                        <el-input type="remark" v-model="groupForm.remark" autocomplete="off"></el-input>
                    </el-form-item>
                </el-form>

                <div slot="footer" class="dialog-footer">
                    <el-button @click="addFormVisible = false">取 消</el-button>
                    <el-button type="primary" @click="handleAddGroup('groupForm')">确 定</el-button>
                </div>
            </el-dialog>

            <el-dialog title="编辑企业" :visible.sync="editFormVisible" :width="editFormWidth">
                <el-form :model="groupForm" ref="groupForm">
                    <el-form-item :label-width="formLabelWidth" prop="groupname" label="企业名" required :rules="[
                            {required: true, message: '请输入企业名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                        <el-input type="groupname" v-model="groupForm.groupname" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="groupuser" label="联系人" required :rules="[
                            {required: true, message: '请输入联系人' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                        <el-input type="groupuser" v-model="groupForm.groupuser" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="groupphone" label="联系方式" required :rules="[
                            {required: true, message: '请输入联系方式' }
                        ]">
                        <el-input type="contractEndTime" v-model="groupForm.groupphone" autocomplete="off"></el-input>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="contractEndTime" label="到期时间">
                        <el-date-picker
                                v-model="groupForm.contractEndTime"
                                align="right"
                                type="date"
                                placeholder="选择日期"
                                :picker-options="pickerOptions"
                                format="yyyy 年 MM 月 dd 日"
                                value-format="yyyy-MM-dd">>
                        </el-date-picker>
                    </el-form-item>

                    <el-form-item :label-width="formLabelWidth" prop="remark" label="备注" required :rules="[
                            {required: true, message: '请输入备注' }
                        ]">
                        <el-input type="remark" v-model="groupForm.remark" autocomplete="off"></el-input>
                    </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="editFormVisible = false">取 消</el-button>
                    <el-button type="primary" @click="handleEditGroup('groupForm')">确 定</el-button>
                </div>
            </el-dialog>

        </div>
    </div>
</template>

<template id="hr-table">
    <div class="block">
        <div style="display: flex">
            <div style="width: 1220px">
                <h1 style="color: rgba(91, 191, 177, 1);">企业用户</h1>
                <el-form class="demo-ruleForm" :inline="true">
                    <el-form-item label="" style="width: 200px">
                        <el-input type="text" size="mini" autocomplete="off" placeholder="账户名" v-model="queryParam.username"></el-input>
                    </el-form-item>
                    <el-form-item label="" style="width: 150px">
                        <el-select size="mini" placeholder="状态" v-model="queryParam.status">
                            <el-option label="启用" value="0"></el-option>
                            <el-option label="禁用" value="1"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item>
                        <el-button size="mini" type="primary" @click="handleQuery">搜索</el-button>
                        <el-button size="mini" @click="handleReset">重置</el-button>
                    </el-form-item>
                    <el-form-item style="margin-left: 330px">
                        <template slot-scope="scope">
                            <el-button size="mini" type="primary" @click="showAddForm('groupUserForm')">新增</el-button>
                            <el-button size="mini" type="primary" @click="showEditForm('groupUserForm',scope.row)">编辑</el-button>
                        </template>
                    </el-form-item> 
                </el-form>
                <el-table :data="td" ref="userTable" highlight-current-row stripe
                          @current-change="handleSelectChange" :default-sort = "{prop:'updatetime', order: 'descending'}">
                    <el-table-column
                            type="selection"
                            width="50">
                    </el-table-column>
                    <el-table-column label="序号" width="50" type="index" align="center">
                    </el-table-column>
                    <el-table-column prop="groupname" label="所属企业" width="180" align="center">
                    </el-table-column>
                    <el-table-column prop="username" label="用户名" width="120" align="center">
                    </el-table-column>
                    <el-table-column prop="realname" label="姓名" width="120" align="center">
                    </el-table-column>
                    <el-table-column label="状态" width="80" align="center">
                        <template slot-scope="scope">
                            <span v-if="scope.row.status===0" style="color:green">{{ groupUserStatusText(scope.row.status) }}</span>
                            <span v-else style="color:red">{{ groupUserStatusText(scope.row.status) }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="updatetime" label="更新时间" width="200" align="center" sortable>
                    </el-table-column>
                    <el-table-column label="操作" align="center"  width="230" align="center">
                        <template slot-scope="scope">
                            <el-button v-if="scope.row.status===0" size="mini" type="danger"
                                       @click="handleIsdel(scope.row)">禁用</el-button>
                            <el-button v-if="scope.row.status===1" size="mini" type="success"
                                       @click="handleIsdel(scope.row)">启用</el-button>
                            <el-button size="mini" type="primary"
                                       @click="showEditForm('groupUserForm',scope.row)">编辑</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <el-pagination v-if="showPage" background layout="prev, pager, next"
                               :total="total" @current-change="handleCurrentChange">
                </el-pagination>

                <el-dialog title="新增账户" :visible.sync="addFormVisible" :width="addFormWidth">
                    <el-form :model="groupUserForm" ref="groupUserForm">
                        <el-form-item :label-width="formLabelWidth" prop="username" label="账户名" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input type="username" v-model="groupUserForm.username" autocomplete="off"></el-input>
                        </el-form-item>

                        <el-form-item :label-width="formLabelWidth" prop="realname" label="姓名" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input type="realname" v-model="groupUserForm.realname" autocomplete="off"></el-input>
                        </el-form-item>
                    </el-form>

                    <div slot="footer" class="dialog-footer">
                        <el-button @click="addFormVisible = false">取 消</el-button>
                        <el-button type="primary" @click="handleAddUser('groupUserForm')">确 定</el-button>
                    </div>
                </el-dialog>
                <el-dialog title="编辑账户" :visible.sync="editFormVisible" :width="editFormWidth">
                    <el-form :model="groupUserForm" ref="groupUserForm">
                        <el-form-item prop="username" label="账户名" :label-width="formLabelWidth" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input v-model="groupUserForm.username" autocomplete="off" prop="groupUserForm.username"></el-input>
                        </el-form-item>
                        <el-form-item prop="realname" label="真实姓名" :label-width="formLabelWidth" required :rules="[
                            {required: true, message: '请输入真实姓名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input v-model="groupUserForm.realname" autocomplete="off" prop="groupUserForm.realname"></el-input>
                        </el-form-item>
                    </el-form>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="editFormVisible = false">取 消</el-button>
                        <el-button type="primary" @click="handleEditUser('groupUserForm')">确 定</el-button>
                    </div>
                </el-dialog>
            </div>
        </div>

    </div>
</template>

<template id="internalusers-table">
    <div class="block">
        <div style="display: flex">
            <div style="width: 1220px">
                <h1 style="color: rgba(91, 191, 177, 1);">账户管理</h1>
                <el-form class="demo-ruleForm" :inline="true">
                    <el-form-item label="" style="width: 200px">
                        <el-input type="text" size="mini" autocomplete="off" placeholder="账户名" v-model="queryParam.username"></el-input>
                    </el-form-item>
                    <el-form-item label="" style="width: 150px">
                        <el-select size="mini" placeholder="状态" v-model="queryParam.isdel">
                            <el-option label="启用" value="0"></el-option>
                            <el-option label="禁用" value="1"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item>
                        <el-button size="mini" type="primary" @click="handleQuery">搜索</el-button>
                        <el-button size="mini" @click="handleReset">重置</el-button>
                    </el-form-item>
                    <el-form-item style="margin-left: 360px">
                        <template slot-scope="scope">
                            <el-button size="mini" type="primary" @click="showAddForm('userForm')">新增</el-button>
                            <el-button size="mini" type="primary" @click="showEditForm('userForm',scope.row)">编辑</el-button>
                        </template>
                    </el-form-item>
                </el-form>

                <el-table :data="td" ref="userTable" highlight-current-row stripe
                          @current-change="handleSelectChange" @row-click="handleRowClick" :default-sort = "{prop:'updatetime', order: 'descending'}">
                    <el-table-column
                            type="selection"
                            width="50">
                    </el-table-column>
                    <el-table-column label="序号" width="50" type="index" align="center">
                    </el-table-column>
                    <el-table-column prop="username" label="账户名" width="80" align="center">
                    </el-table-column>
                    <el-table-column prop="realname" label="姓名" width="80" align="center">
                    </el-table-column>
                    <el-table-column label="状态" width="50" align="center">
                        <template slot-scope="scope">
                            <span v-if="scope.row.isdel===0" style="color:green">{{ userStatusText(scope.row.isdel) }}</span>
                            <span v-else style="color:red">{{ userStatusText(scope.row.isdel) }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="creatorname" label="创建人" width="80" align="center">
                    </el-table-column>
                    <el-table-column prop="createtime" label="创建时间" width="180" align="center" sortable>
                    </el-table-column>
                    <el-table-column prop="updatorname" label="编辑人" width="80" align="center">
                    </el-table-column>
                    <el-table-column prop="updatetime" label="编辑时间" width="180" align="center" sortable>
                    </el-table-column>
                    <el-table-column label="操作" align="center"  width="230" align="center">
                        <template slot-scope="scope">
                            <el-button v-if="scope.row.isdel===0" size="mini" type="danger"
                                       @click="handleIsdel(scope.row)">禁用</el-button>
                            <el-button v-if="scope.row.isdel===1" size="mini" type="success"
                                       @click="handleIsdel(scope.row)">启用</el-button>
                            <el-button size="mini" type="primary"
                                       @click="showEditForm('userForm',scope.row)">编辑</el-button>
                        </template>
                    </el-table-column>
                </el-table>

                <el-pagination v-if="showPage" background layout="prev, pager, next"
                               :total="total" @current-change="handleCurrentChange">
                </el-pagination>

                <el-dialog title="新增账户" :visible.sync="addFormVisible" :width="addFormWidth">
                    <el-form :model="userForm" ref="userForm">
                        <el-form-item :label-width="formLabelWidth" prop="username" label="账户名" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input type="username" v-model="userForm.username" autocomplete="off"></el-input>
                        </el-form-item>

                        <el-form-item :label-width="formLabelWidth" prop="realname" label="姓名" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input type="realname" v-model="userForm.realname" autocomplete="off"></el-input>
                        </el-form-item>
                    </el-form>

                    <div slot="footer" class="dialog-footer">
                        <el-button @click="addFormVisible = false">取 消</el-button>
                        <el-button type="primary" @click="handleAddUser('userForm')">确 定</el-button>
                    </div>
                </el-dialog>
                <el-dialog title="编辑账户" :visible.sync="editFormVisible" :width="editFormWidth">
                    <el-form :model="userForm" ref="userForm">
                        <el-form-item prop="username" label="账户名" :label-width="formLabelWidth" required :rules="[
                            {required: true, message: '请输入账户名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input v-model="userForm.username" autocomplete="off" prop="userForm.username"></el-input>
                        </el-form-item>
                        <el-form-item prop="realname" label="真实姓名" :label-width="formLabelWidth" required :rules="[
                            {required: true, message: '请输入真实姓名' },
                            {min: 2, max: 20, message: '长度在 2 到 20 个字符' },
                            {pattern: /^[\w\u4E00-\u9FA5-]+$/, message: '不能有特殊字符'}
                        ]">
                            <el-input v-model="userForm.realname" autocomplete="off" prop="userForm.realname"></el-input>
                        </el-form-item>
                    </el-form>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="editFormVisible = false">取 消</el-button>
                        <el-button type="primary" @click="handleEditUser('userForm')">确 定</el-button>
                    </div>
                </el-dialog>
            </div>
        </div>
    </div>
</template>

</body>

<script>
    var components = {
        'group-table':{
            props: ['menush'],
            data:function(){
                var that = this;
                (function queryGroupList(){
                    $.get('/listGroup',function(res){
                        if(res.code === 0){
                            that.td = res.data.list;
                            that.total = parseInt(res.data.total);
                            that.showPage = that.total > 0;
                        }

                    });
                    $.get('/groupRemind',function(res){
                        that.tdd = res.data.list;
                        that.tdd_total = parseInt(res.data.total);
                        that.tdd_showPage = that.tdd_total > 0;
                    });
                    if(!that.menush.group_table){
                        console.log('change...')
                        return false;
                    }
                    setTimeout(queryGroupList,60000);
                })();
                return {
                    pickerOptions: {
                        disabledDate(time) {
                            return time.getTime() < Date.now();
                        },
                        shortcuts: [{
                            text: '今天',
                            onClick(picker) {
                                picker.$emit('pick', new Date());
                            }
                        }, {
                            text: '明天',
                            onClick(picker) {
                                const date = new Date();
                                date.setTime(date.getTime() + 3600 * 1000 * 24);
                                picker.$emit('pick', date);
                            }
                        }, {
                            text: '一周后',
                            onClick(picker) {
                                const date = new Date();
                                date.setTime(date.getTime() + 3600 * 1000 * 24 * 7);
                                picker.$emit('pick', date);
                            }
                        }]
                    },
                    td: [],
                    tdd: [],
                    addFormVisible: false,
                    editFormVisible: false,
                    addFormWidth: '38%',
                    editFormWidth: '38%',
                    formLabelWidth: '120px',
                    groupForm:{
                        id:'',
                        groupname: '',
                        groupuser: '',
                        groupphone: '',
                        contractEndTime: '',
                        remark:''
                    },
                    queryParam: {groupname:'',status:'',legalize:''},
                    groupDateForm: {
                        groupDate: ''
                    },
                    groupDateFormWidth: '25%',
                    grouptDateFormVisible: false,
                    groupDate: '',
                    total: 0,
                    tdd_total: 0,
                    cPage: 1,
                    tdd_showPage: false,
                    showPage: false,
                    multipleSelection:[]
                }
            },
            methods:{
                handleSelectionChange(val) {
                    this.multipleSelection = val;
                    if (val.length > 0){
                        var index = val.length-1;
                        this.groupForm.id=val[index].id;
                        this.groupForm.groupname=val[index].groupname;
                        this.groupForm.groupuser=val[index].groupuser;
                        this.groupForm. groupphone=val[index].groupphone;
                        this.groupForm.contractEndTime=val[index].contractEndTime;
                        this.groupForm.remark=val[index].remark;
                    }
                },
                showGroupDateForm: function(group){
                    if(group.groupStatus === 2){
                        this.$message({ message: '预约已经生效了哦！', type: 'warning'});
                        return;
                    }
                    this.groupDateForm.groupId = group.groupId;
                    this.groupDateForm.groupDate = group.groupDate;
                    this.groupDateFormVisible = true;
                },
                queryData: function(param){
                    var that = this;
                    $.ajax({
                        url: "/listGroup",
                        type:'get',
                        data: param,
                        success:function(res){
                            that.td = res.data.list;
                        }
                    });
                },
                handleQuery: function(){
                    this.queryData($.extend({pageNum:1},this.queryParam));
                },
                handleReset: function(){
                    this.queryParam = {groupname:'',status:'',legalize:''}
                },
                groupStatusText: function(value){
                    var statusDict = {
                        '0': '启用',
                        '1': '禁用'
                    };
                    return statusDict[value];
                },
                groupLegalizeText: function(value){
                    var legalizeDict = {
                        '0': '已认证',
                        '1': '未认证'
                    };
                    return legalizeDict[value];
                },
                handleTddCurrentChange: function(cPage){
                    var that = this;
                    $.get('/groupRemind?pageNum=' + cPage, function(res){
                        that.tdd = res.data.list;
                    });
                },
                handleCurrentChange: function(cPage){
                    this.cPage = cPage;
                    var that = this;
                    $.get('/listGroup?pageNum=' + cPage, function(res){
                        that.td = res.data.list;
                    });
                },
                showAddForm: function(formName){
                    this.addFormVisible = true;
                    this.groupForm.groupname=null;
                    this.groupForm.groupuser=null;
                    this.groupForm. groupphone=null;
                    this.groupForm.contractEndTime=null;
                    this.groupForm.remark=null;
                },
                handleAddGroup: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/addGroup',that.groupForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '新增企业成功！', type: 'success'});
                                    that.addFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                showEditForm: function(){
                    this.editFormVisible = true;
                },
                handleEditGroup: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/editGroup',that.groupForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '编辑企业成功！', type: 'success'});
                                    that.editFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                delGroup: function(){
                    var that = this;
                    $.post('/delGroup',{id: that.groupForm.id},function(){
                        that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                        that.$message({ message: '删除成功！', type: 'success'});
                    });
                }
            },
            template:'#group-table'
        },

        'hr-table':{
            data:function(){
                var that = this;
                $.get('/listGroupUser',function(res){
                    console.log(res)
                    that.td = res.data.list;
                    that.total = parseInt(res.data.total);
                    that.showPage = that.total > 0;
                    // if(that.total > 0){
                    // that.$refs.userTable.setCurrentRow(that.td[0]);
                    // }
                });
                return {
                    td: [],
                    total: 0,
                    cPage: 1,
                    showPage: false,
                    queryParam: {username:'',status:''},
                    addFormVisible: false,
                    editFormVisible: false,
                    sloganFormVisible: false,
                    groupUserForm:{
                        id:'',
                        groupname:'',
                        username: '',
                        realname: '',
                        status: ''
                    },
                    sloganForm:{},
                    currentRow: {},
                    currentRowIndex: 0,
                    remnant: 100,
                    formLabelWidth: '120px',
                    addFormWidth: '28%',
                    editFormWidth: '28%',
                    sloganFormWidth: '25%',
                    carPictureStyle: {width: '500px',height: '400px'},
                    editCarIcon: false,
                    editMainCarIcon: false,
                    mainImage: '',
                    mainImgRadio:'',
                    delCarImageIds: '',
                    cutPictureVisible: false

                }
            },
            methods:{
                cancelImage: function(){
                    this.editCarIcon = false;
                    this.editMainCarIcon = false;
                    this.queryData($.extend({pageNum:this.cPage},this.queryParam));
                },
                delCarImage: function(img){
                    var imgArr = this.currentRow.carImages;
                    for(var i = 0; i< imgArr.length; i++){
                        if(imgArr[i].carImageId == img.carImageId){
                            this.currentRow.carImages.splice(i, 1);
                            break;
                        }
                    }
                    this.delCarImageIds += img.carImageId + ','
                },
                editCarImage: function(){
                    //删除图片
                    var that = this;
                    this.editCarIcon = false;
                    this.editMainCarIcon = false;
                    if(this.delCarImageIds.length > 0){
                        $.ajax({
                            type: 'post',
                            url: '/delCarImage',
                            data: {delCarImageIds: this.delCarImageIds.substr(0, this.delCarImageIds.length - 1)},
                            success: function(){
                                that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                            }
                        })
                    }
                },
                changeCarMainImage: function(){
                    //修改主图
                    var that = this;
                    this.editCarIcon = false;
                    this.editMainCarIcon = false;
                    $.post('/changeMainImage', {carId: this.currentRow.carId, mainImageId: this.mainImgRadio.replace('la', '')}, function(){
                        that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                    })

                },
                cancelCutPicture: function(){
                    $('#car_image_input').val('');
                    $('#cut-image-div').css('display', 'none');
                },
                uploadCutPicture: function(){

                    var doUpload = function(formData){
                        $.ajax({
                            url: "/uploadCarImag",
                            type: 'POST',
                            cache: false,
                            data: formData,
                            processData: false,
                            contentType: false,
                            dataType:"json",
                            success : function(res) {
                                if(res.code == 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '上传车辆图片成功！', type: 'success'});
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                                $('#cut-image-div').css('display', 'none');
                                $('#compress-image-div').css('display', 'none');
                            },
                            error:function(data){
                            }
                        });


                        $('#car_image_input').val('');

                    }
                    var that = this;
                    var cutPictureData = $('#cutImg').cropper('getData', true);
                    var formData = new FormData($('#carImageForm')[0]);
                    formData.append('x', cutPictureData.x);
                    formData.append('y', cutPictureData.y);
                    formData.append('width', cutPictureData.width);
                    formData.append('height', cutPictureData.height);
                    var fileObj = $('#car_image_input')[0].files[0];
                    if(fileObj.size/1024 > 300) { //大于800k，进行压缩上传
                        $('#compress-image-div').css('display', 'block');
                        photoCompress(fileObj, { quality: 0.2 }, function(base64Codes){
                            var bl = convertBase64UrlToBlob(base64Codes);
                            formData.set("file", bl, "file_" + fileObj.name);
                            doUpload(formData);
                        });
                    }else{
                        doUpload(formData);
                    }

                },
                handleUploadCarImage: function(){
                    var msg = validateImageFile($('#car_image_input'));
                    if(msg){
                        this.$message({ message: msg, type: 'error'});
                        return false;
                    }
                    this.cutPictureVisible = true;
                    $('#cut-image-div').css('display', 'block');
                    $('.container').empty()
                    var $img = $("<img id='cutImg' src=''>");
                    $('.container').append($img);
                    $img.attr('src', '');
                    var $file = $('#car_image_input');
                    var fileObj = $file[0];
                    var windowURL = window.URL || window.webkitURL;
                    var dataURL;
                    if (fileObj && fileObj.files && fileObj.files[0]) {
                        dataURL = windowURL.createObjectURL(fileObj.files[0]);
                        $img.attr('src', dataURL);
                    } else {
                        dataURL = $file.val();
                        var imgObj = document.getElementById("preview");
                        // 两个坑:
                        // 1、在设置filter属性时，元素必须已经存在在DOM树中，动态创建的Node，也需要在设置属性前加入到DOM中，先设置属性在加入，无效；
                        // 2、src属性需要像下面的方式添加，上面的两种方式添加，无效；
                        imgObj.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                        imgObj.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = dataURL;
                    }
                    $img.cropper({
                        aspectRatio: 16 / 9,
                        preview:".small",
                        crop: function(event) {
                            // console.log(event.detail.x);
                            // console.log(event.detail.y);
                            // console.log(event.detail.width);
                            // console.log(event.detail.height);
                            // console.log(event.detail.rotate);
                            // console.log(event.detail.scaleX);
                            // console.log(event.detail.scaleY);
                        }
                    });

                },
                uploadCarImg: function(){
                    if(this.currentRow && this.currentRow.carId){
                        $('#car_image_input').click();
                    }
                },
                handleSaveIntroduction: function(){
                    var that = this;
                    var parm = {carId:this.currentRow.carId, introduction: this.currentRow.introduction};
                    $.post('/updateCar', parm, function(res){
                        if(res.code === 0){
                            that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                            that.$message({ message: '详情介绍保存成功！', type: 'success'});
                        }else{
                            that.$message({ message: res.msg, type: 'error'});
                        }
                    });
                },
                //点击行触发，选中或不选中复选框
                handleRowClick(row) {
                    this.$refs.userTable.toggleRowSelection(row);
                },
                toggleSelection(rows) {
                    if (rows) {
                        rows.forEach(row => {
                            this.$refs.userTable.toggleRowSelection(row);
                        });
                    } else {
                        this.$refs.multipleTable.clearSelection();
                    }
                },
                handleSelectChange: function(val){
                    //选中某行，更新右边栏信息
                    if(!val)return;
                    for(var i = 0; i< this.td.length; i++){
                        if(this.td[i].carId === val.carId){
                            this.currentRowIndex = i;
                            break;
                        }
                    }
                    this.currentRow = val;
                    this.mainImgRadio = 'la' + val.mainImageId;
                    this.remnant = 100;
                    if(this.currentRow.introduction){
                        this.remnant = 100 - this.currentRow.introduction.length;
                    }
                },
                handleUpdateSlogan: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/updateCar', that.sloganForm, function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '更新宣传语成功！', type: 'success'});
                                    that.sloganFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        }
                    });

                },
                handleUpdateIndex: function(value, car){
                    var that = this;
                    var updateParam = {carId:car.carId, carIndex:value};
                    $.post('/updateCar', updateParam, function(res){
                        if(res.code === 0){
                            that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                            that.$message({ message: '更新序号成功！', type: 'success'});

                        }else{
                            that.$message({ message: res.msg, type: 'error'});
                        }
                    });
                },
                showSloganForm: function(formName, car){
                    Vue.set(this.sloganForm, 'carId', car.carId);
                    Vue.set(this.sloganForm, 'carSlogan', car.carSlogan);
                    this.sloganFormVisible = true;
                    // this.$refs[formName].resetFields();
                },
                showAddForm: function(formName){
                    this.addFormVisible = true;
                    this.groupUserForm.id=null;
                    this.groupUserForm.username=null;
                    this.groupUserForm.realname=null;
                },
                showEditForm: function(formName,row){
                    this.editFormVisible = true;
                    this.groupUserForm.id=row.id;
                    this.groupUserForm.username=row.username;
                    this.groupUserForm.realname=row.realname;
                },
                groupUserStatusText: function(value){
                    var groupUserStatusDic = {
                        '0': '启用',
                        '1': '禁用'
                    };
                    return groupUserStatusDic[value];
                },
                queryData: function(param){
                    var that = this;
                    $.ajax({
                        url:'/listGroupUser',
                        type:'get',
                        data: param,
                        success:function(res){
                            that.td = res.data.list;
                            that.$refs.userTable.setCurrentRow(that.td[that.currentRowIndex]);
                        }
                    });
                },
                handleAddUser: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/addUser',that.groupUserForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '新增后台账户成功！', type: 'success'});
                                    that.addFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                handleEditUser: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/editUser',that.groupUserForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '编辑后台账户成功！', type: 'success'});
                                    that.editFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                handleCurrentChange: function(cPage){
                    this.cPage = cPage;
                    this.queryData($.extend({pageNum:cPage},this.queryParam));
                },
                handleQuery: function(){
                    this.queryData($.extend({pageNum:1},this.queryParam));
                },
                handleReset: function(){
                    this.queryParam = {username:'',status:''}
                },
                handleIsdel: function(user){
                    var that = this;
                    $.post('/groupUserIsdel',{id: user.id,isdel:user.isdel},function(){
                        that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                        that.$message({ message: '操作成功！', type: 'success'});
                    });
                },
            },
            template:'#hr-table'
        },
        'internalusers-table':{
            data:function(){
                var that = this;
                $.get('/listUser',function(res){
                    that.td = res.data.list;
                    that.total = parseInt(res.data.total);
                    that.showPage = that.total > 0;
                });
                return {
                    td: [],
                    total: 0,
                    cPage: 1,
                    showPage: false,
                    queryParam: {username:'',isdel:''},
                    addFormVisible: false,
                    editFormVisible: false,
                    sloganFormVisible: false,
                    userForm:{
                        id:null,
                        username: '',
                        realname: '',
                        isdel: '',
                        creator: '',
                        updator:'',
                    },
                    sloganForm:{},
                    currentRow: {},
                    currentRowIndex: 0,
                    remnant: 100,
                    formLabelWidth: '120px',
                    addFormWidth: '28%',
                    editFormWidth: '28%',
                    sloganFormWidth: '25%',
                    carPictureStyle: {width: '500px',height: '400px'},
                    editCarIcon: false,
                    editMainCarIcon: false,
                    mainImage: '',
                    mainImgRadio:'',
                    delCarImageIds: '',
                    cutPictureVisible: false

                }
            },
            methods:{
                handleSelectChange(val){
                    console.log(val);
                    this.userForm.id=val.id;
                    this.userForm.username=val.username;
                    this.userForm.realname=val.realname;
                },
                //点击行触发，选中或不选中复选框
                handleRowClick(row, column, event) {
                    this.$refs.userTable.toggleRowSelection(row);
                },
                toggleSelection(rows) {
                    if (rows) {
                        rows.forEach(row => {
                            this.$refs.userTable.toggleRowSelection(row);
                        });
                    } else {
                        this.$refs.multipleTable.clearSelection();
                    }
                },
                clearSelection(){
                    this.userForm=null;
                },
                showSelectEditForm: function(formName){
                    this.editFormVisible = true;
                },
                handleUpdateSlogan: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/updateCar', that.sloganForm, function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '更新宣传语成功！', type: 'success'});
                                    that.sloganFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        }
                    });

                },
                showAddForm: function(formName){
                    this.addFormVisible = true;
                    this.userForm.id=null;
                    this.userForm.username=null;
                    this.userForm.realname=null;
                },
                showEditForm: function(formName,row){
                    this.editFormVisible = true;
                    console.log(row);
                    this.userForm.id=row.id;
                    this.userForm.username=row.username;
                    this.userForm.realname=row.realname;
                },
                userStatusText: function(value){
                    var carStatusDic = {
                        '0': '启用',
                        '1': '禁用'
                    };
                    return carStatusDic[value];
                },
                queryData: function(param){
                    var that = this;
                    $.ajax({
                        url:'/listUser',
                        type:'get',
                        data: param,
                        success:function(res){
                            that.td = res.data.list;
                            that.$refs.userTable.setCurrentRow(that.td[that.currentRowIndex]);
                        }
                    });
                },
                handleAddUser: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/addUser',that.userForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '新增后台账户成功！', type: 'success'});
                                    that.addFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                handleEditUser: function(formName){
                    var that = this;
                    this.$refs[formName].validate(function(valid) {
                        if (valid) {
                            $.post('/editUser',that.userForm,function(res){
                                if(res.code === 0){
                                    that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                                    that.$message({ message: '编辑后台账户成功！', type: 'success'});
                                    that.editFormVisible = false;
                                }else{
                                    that.$message({ message: res.msg, type: 'error'});
                                }
                            });
                        } else {
                            return false;
                        }
                    });
                },
                handleCurrentChange: function(cPage){
                    this.cPage = cPage;
                    this.queryData($.extend({pageNum:cPage},this.queryParam));
                },
                handleQuery: function(){
                    this.queryData($.extend({pageNum:1},this.queryParam));
                },
                handleReset: function(){
                    this.queryParam = {username:'',isdel:''}
                },
                handleIsdel: function(user){
                    var that = this;
                    $.post('/isdel',{id: user.id,isdel:user.isdel},function(){
                        that.queryData($.extend({pageNum:that.cPage},that.queryParam));
                        that.$message({ message: '操作成功！', type: 'success'});
                    });
                },
            },
            template:'#internalusers-table'
        },
    };
    var methods = {
        logout: function(){
          $.get('/logout', function(){
              window.location.href = '/login.html';
          });
        },
        handleUpdatePassword: function(){
            if(this.passwordForm.newPassword !== this.passwordForm.rePassword){
                this.$message({message:'两次输入密码不一致！', type:'error'})
            }else{
                var that = this;
                this.$refs.passwordForm.validate(function(valid) {
                    if (valid) {
                        $.post('/updatePassword', that.passwordForm, function(res){
                            if(res.code === 0){
                                window.location.href = '/login.html'
                            }else{
                                that.$message({ message: res.msg, type: 'error'});
                            }
                        });
                    }else{
                        return false;
                    }
                });
            }
        },

        changeMenu: function(index){
            this.showAndHide.group_table = false;
            this.showAndHide.hr_table = false;
            // this.showAndHide.shop_table = false;
            this.showAndHide.internalusers_table = false;
            switch (index) {
                case 1:
                    this.showAndHide.group_table = true;
                    break;
                case 2:
                    this.showAndHide.hr_table = true;
                    break;
                // case 4:
                //     //店面管理
                //     this.showAndHide.shop_table = true;
                //     break;
                case 3:
                    this.showAndHide.internalusers_table = true;
                    break;
            }
        }
    };


    new Vue({
        el: '#app',
        data: {
            loginUserName:'',
            showAndHide:{
                group_table: true, hr_table: false, internalusers_table: false
                // shop_table: false,
            },
            passwordFormVisible: false,
            passwordForm: {},
            passwordFormLabelWidth: '120px',
            passwordFormWidth: '28%'
        },
        methods: methods,
        components: components,
        created: function(){
            var that = this;
            $.ajax({
                url: '/isLogin',
                type:'get',
                success:function(res){
                    if(res.data.status !== 0){
                        window.location.href = '/login.html'
                    }else{
                        that.loginUserName  = res.data.username;
                    }
                }
            });
        }
    });
</script>
</html>
